<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MediZoom - Medical Consultation</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ©º</text></svg>">
</head>
<body data-page="room">
  <div class="app-container meeting-layout">
    <!-- LEFT: Video area -->
    <div class="video-section">
      <!-- Top bar: room info -->
      <div class="top-bar">
        <div class="room-info">
          <span class="badge">Medical Consultation</span>
          <span id="roomLabel" class="room-label"></span>
          <span id="hostBadge" class="host-badge" style="display: none;">ğŸ‘‘ Host</span>
        </div>
        <div class="top-bar-right">
          <button id="btnParticipants" class="btn participants-btn">
            ğŸ‘¥ Participants
          </button>
          <div class="user-info">
            <span id="usernameLabel" class="username-label"></span>
          </div>
        </div>
      </div>

      <!-- Remote videos grid -->
      <div id="remoteVideos" class="remote-videos-grid">
        <!-- Videos will be added here automatically -->
      </div>

      <!-- Controls -->
      <div class="controls-bar">
        <button id="btnToggleMic" class="btn control-btn">
          ğŸ™ï¸ Mute
        </button>
        <button id="btnToggleCamera" class="btn control-btn">
          ğŸ“· Camera Off
        </button>
        <button id="btnShareScreen" class="btn control-btn">
          ğŸ–¥ï¸ Share Screen
        </button>
        <button id="btnLeave" class="btn control-btn">
          ğŸšª Leave
        </button>
      </div>
    </div>

<!-- RIGHT: Integrated AI + Chat Sidebar -->
<div class="sidebar">
  <div class="sidebar-section ai-chat-integrated">
    <!-- AI Section - Always Visible -->
    <div class="ai-section-integrated">
      <h2 class="sidebar-title">ğŸ©º Medical Analysis</h2>
      
      <!-- Upload Form -->
      <form id="aiForm" class="ai-form">
        <label class="label">Upload Medical Image (X-Ray, CT, etc.)</label>
        <input id="aiFile" type="file" name="file" accept="image/*" class="input" />
        <button type="submit" class="btn primary-btn">Upload & Analyze</button>
      </form>

      <!-- Analysis Results -->
      <div id="analysisResults" class="analysis-results-integrated" style="display: none;">
        <!-- Annotation Tools ABOVE Image -->
        <div class="annotation-tools-integrated">
          <div class="tools-header">
            <h4>ğŸ–Œï¸ Annotation Tools</h4>
            <div class="user-color-indicator">
              Your color: <span id="userColorBadge" class="color-badge"></span>
            </div>
          </div>
          
          <div class="tools-row">
            <div class="tool-group">
              <button class="tool-btn active" data-tool="pen">âœï¸</button>
              <button class="tool-btn" data-tool="eraser">ğŸ§¹</button>
              <button class="tool-btn" data-tool="highlighter">ğŸ–ï¸</button>
            </div>
            <div class="tool-group">
              <button class="tool-btn" data-tool="circle">â­•</button>
              <button class="tool-btn" data-tool="rectangle">â¬œ</button>
              <button class="tool-btn" data-tool="arrow">â¡ï¸</button>
            </div>
            <div class="tool-group">
              <input type="color" id="colorPicker" value="#4CAF50">
              <input type="range" id="brushSize" min="1" max="20" value="3">
              <span id="brushSizeValue">3px</span>
            </div>
            <div class="tool-group">
              <button id="clearCanvas" class="tool-btn danger">ğŸ—‘ï¸</button>
              <button id="undoDrawing" class="tool-btn">â†©ï¸</button>
            </div>
          </div>
          <div id="userIndicators" class="user-indicators"></div>
        </div>

        <!-- Big Image Display -->
        <div class="image-canvas-integrated">
          <div class="canvas-wrapper-integrated">
            <img id="aiImagePreview" src="" alt="Medical image" class="ai-image-preview-integrated" />
            <canvas id="annotationCanvas" class="annotation-canvas-integrated"></canvas>
          </div>
        </div>

        <!-- AI Result -->
        <div id="aiResult" class="ai-result-integrated"></div>
        
        <!-- Report Button BELOW Image -->
        <div class="report-ai-integrated">
          <button id="generateReportBtn" class="btn primary-btn report-btn-integrated">
            ğŸ“‹ Generate AI Report (Gemini)
          </button>
          <div id="reportLoading" class="report-loading" style="display: none;">
            â³ AI is generating medical report...
          </div>
          <div id="reportResult" class="ai-report-result-integrated"></div>
        </div>
      </div>
    </div>

    <!-- Chat Section - With Scroll Bar -->
    <div class="chat-section-integrated">
      <h3 class="chat-title-integrated">ğŸ’¬ Chat</h3>
      <div id="chatMessages" class="chat-messages-integrated">
        <!-- Messages will appear here -->
      </div>
      <form id="chatForm" class="chat-form-integrated">
        <input id="chatInput" type="text" class="input chat-input-integrated" 
               placeholder="Type a message and hit Enter..." autocomplete="off" />
      </form>
    </div>
  </div>
</div>
  <!-- Participants Popup -->
  <div id="participantsPopup" class="popup-overlay">
    <div class="popup-content">
      <div class="popup-header">
        <h2>ğŸ‘¥ Participants</h2>
        <button id="closeParticipantsPopup" class="btn close-btn">Ã—</button>
      </div>
      
      <div class="popup-body">
        <div id="participantsList" class="participants-list">
          <!-- Participants will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="script.js"></script>
</body>
</html>